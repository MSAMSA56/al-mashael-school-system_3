<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø¹Ù„</title>
  <meta name="color-scheme" content="light dark"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #0b1220; --card: #111a2b; --muted:#94a3b8; --text:#e2e8f0;
      --primary:#ef4444; --primary-600:#dc2626; --danger:#ef4444;
      --ring: rgba(239,68,68,.35); --input:#1f2a44; --shadow: 0 20px 45px rgba(2,6,23,.35);
    }
    [data-theme="light"] {
      --bg:#f6f7fb; --card:#fff; --muted:#475569; --text:#0f172a;
      --primary:#dc2626; --primary-600:#b91c1c; --danger:#dc2626;
      --ring: rgba(220,38,38,.25); --input:#f1f5f9; --shadow: 0 18px 36px rgba(15,23,42,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Cairo", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 500px at 90% -10%, rgba(239,68,68,.08), transparent 60%),
                  radial-gradient(900px 500px at -10% 110%, rgba(34,197,94,.08), transparent 60%),
                  var(--bg);
      color: var(--text);
      display:grid; place-items:center; padding:24px;
    }
    .app{width:100%; max-width:480px; display:grid; gap:24px}
    .card{background: linear-gradient(180deg, color-mix(in oklab, var(--card), transparent 8%), var(--card));
      border:1px solid color-mix(in oklab, var(--text), transparent 88%); border-radius:16px; box-shadow:var(--shadow); padding:28px}
    .header{text-align:center; margin-bottom:24px}
    .role-badge{display:inline-flex; align-items:center; gap:8px; background:var(--primary); color:white; padding:8px 16px; border-radius:12px; font-size:14px; font-weight:600; margin-bottom:16px}
    h1{margin:0 0 8px 0; font-size:28px}
    .subtitle{color:var(--muted); font-size:14px; margin:0}
    .grid{display:grid; gap:12px}
    .row{display:grid; gap:8px}
    .label{font-size:14px; color:var(--muted)}
    .input{appearance:none; background:var(--input); color:var(--text); border:1px solid transparent; border-radius:12px; padding:12px 14px; outline:none; transition:.2s; width:100%}
    .input:focus{box-shadow:0 0 0 6px var(--ring); border-color:var(--primary)}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:12px 14px; border-radius:12px; border:1px solid transparent; cursor:pointer; transition:.2s; font-weight:600; width:100%}
    .btn.primary{background:var(--primary); color:white}
    .btn.primary:hover{background:var(--primary-600)}
    .btn.ghost{background:transparent; color:var(--text); border-color:color-mix(in oklab, var(--text), transparent 84%)}
    .btn.danger{background:var(--danger); color:#fff}
    .hint{font-size:13px; color:var(--muted); text-align:center}
    .success{color:#16a34a; text-align:center}
    .error{color:#ef4444; text-align:center}
    .back-link{text-align:center; margin-top:16px}
    .back-link a{color:var(--muted); text-decoration:none; font-size:14px}
    .back-link a:hover{color:var(--primary)}
    .language-switch {
      text-align:center; margin-bottom:12px; display:flex; justify-content:center; gap:8px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="header">
        <div class="language-switch">
          <button class="btn ghost" id="btn-toggle-lang">English</button>
          <button class="btn ghost" id="btn-toggle-theme">ğŸŒ™/â˜€ï¸</button>
        </div>
        <div class="role-badge">âš™ï¸ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
        <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h1>
        <p class="subtitle">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
      </div>
      
      <div class="grid">
        <div class="row">
          <label class="label" for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input class="input" id="email" placeholder="admin@example.com" type="email"/>
        </div>
        <div class="row">
          <label class="label" for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input class="input" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" type="password"/>
        </div>
        <button class="btn primary" id="btn-login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <button class="btn ghost" id="btn-forgot" type="button">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</button>
      </div>
      
      <div class="hint" id="status"></div>
      
      <div class="back-link">
        <a href="index.html">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆØ±</a>
      </div>
    </div>
  </div>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
    
    const firebaseConfig = {
      apiKey: 'AIzaSyCD-lB-RPKHxDeHrs4243rkqpkQ36ZSUHg',
      authDomain: 'al-mashael-school-system.firebaseapp.com',
      projectId: 'al-mashael-school-system',
      storageBucket: 'al-mashael-school-system.firebasestorage.app',
      messagingSenderId: '387864421863',
      appId: '1:387864421863:web:ef761039351de11ab2c942'
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    const $ = (id) => document.getElementById(id);
    const setStatus = (msg, type='') => {
      const el = $('status');
      el.textContent = msg;
      el.className = 'hint ' + (type || '');
    };
    
    $('btn-login').onclick = async () => {
      const email = $('email').value.trim();
      const password = $('password').value;
      
      if (!email || !password) {
        return setStatus('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
      }
      
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        // Check if user is an admin in admins collection
        const adminRef = doc(db, 'admins', user.uid);
        const adminSnap = await getDoc(adminRef);
        
        if (adminSnap.exists()) {
          setStatus('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
          setTimeout(() => {
            window.location.href = 'dashboard-admin.html';
          }, 1000);
        } else {
          await auth.signOut();
          setStatus('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„ÙŠØ³ Ø­Ø³Ø§Ø¨ Ø¥Ø¯Ø§Ø±Ø©', 'error');
        }
      } catch (error) {
        setStatus('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message, 'error');
      }
    };
    
    // Check if already logged in
    onAuthStateChanged(auth, async (user) => {
      if (!user) return; // Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¨Ø¯ÙˆÙ† ØªØ­Ù‚Ù‚ ØµØ±ÙŠØ­ Ù„ÙƒÙ„ Ø¯Ø®ÙˆÙ„
    });
    // Ø²Ø± Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± â†’ ÙŠÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨
    $('btn-forgot').onclick = () => {
      const email = $('email').value.trim();
      if (!email) return setStatus('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
      const msg = encodeURIComponent(`Ø·Ù„Ø¨ Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø­Ø³Ø§Ø¨ Ø¥Ø¯Ø§Ø±Ø© âš™ï¸\nØ§Ù„Ø¨Ø±ÙŠØ¯: ${email}\nÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨.`);
      window.open(`https://wa.me/966566079856?text=${msg}`, '_blank');
    };
    // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ/Ø§Ù„ÙØ§ØªØ­
    $('btn-toggle-theme').onclick = () => {
      const current = document.body.getAttribute('data-theme') || '';
      document.body.setAttribute('data-theme', current === 'light' ? '' : 'light');
    };
    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© (ÙˆØ§Ø¬Ù‡Ø© Ø£ÙˆÙ„ÙŠØ© ÙÙ‚Ø·)
    $('btn-toggle-lang').onclick = () => {
      alert('Ø³ÙŠØªÙ… Ø¯Ø¹Ù… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù‚Ø±ÙŠØ¨Ù‹Ø§');
    };
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const adminRef = doc(db, 'admins', user.uid);
        const adminSnap = await getDoc(adminRef);
        if (adminSnap.exists()) {
          window.location.href = 'dashboard-admin.html';
        }
      }
    });
  </script>
</body>
</html>
