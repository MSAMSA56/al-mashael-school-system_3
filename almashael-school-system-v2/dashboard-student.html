<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ | Ø§Ù„Ù…Ø´Ø§Ø¹Ù„</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://www.gstatic.com https://www.googleapis.com https://firebaseinstallations.googleapis.com; script-src 'self' https://www.gstatic.com https://www.googleapis.com 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://*; connect-src 'self' https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://www.googleapis.com https://firebaseinstallations.googleapis.com; frame-ancestors 'self'; base-uri 'self'; form-action 'self'">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f172a;--panel:#111827ee;--card:#0b1220;--muted:#94a3b8;--text:#e5e7eb;--pri:#06b6d4;--pri-2:#22d3ee;--ok:#22c55e;--ring:0 0 0 3px color-mix(in oklab, var(--pri) 35%, transparent)}
    *{box-sizing:border-box}html,body{height:100%}body{margin:0;background:linear-gradient(160deg,#0b1020,#0a1428 55%,#0c1b2f);color:var(--text);font-family:"Tajawal",system-ui,Roboto,Arial,sans-serif}
    header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(10px);background:#0b1220cc;border-bottom:1px solid #1f2937}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    .brand{display:flex;align-items:center;gap:12px}.brand .logo{width:36px;height:36px;border-radius:10px;background:radial-gradient(circle at 30% 30%, #22d3ee, #06b6d4 40%, #0ea5e9 70%, transparent 71%), linear-gradient(135deg,#0ea5e9,#06b6d4)}.brand h1{font-size:20px;margin:0}
    .grid{display:grid;gap:16px}@media(min-width:900px){.grid{grid-template-columns:2fr 1fr}}
    .card{background:linear-gradient(180deg,#0e1628,#0b1220);border:1px solid #1f2a3a;border-radius:16px;padding:16px}
    .card h2{margin:0 0 12px;font-size:18px}
    .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;margin:10px 0 16px}
    .btn{background:linear-gradient(135deg,#0891b2,#06b6d4);color:#001018;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .table{width:100%;border-collapse:collapse}.table th,.table td{padding:10px;border-bottom:1px solid #1f2a3a;text-align:center}
    .pill{padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700}.pill.ok{background:#052e1a;color:#52ffa2;border:1px solid #0a5}.pill.warn{background:#2e1f05;color:#ffd38a;border:1px solid #a60}
    .muted{color:var(--muted)}.cards{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}@media(min-width:900px){.cards{grid-template-columns:repeat(4,minmax(0,1fr))}}
    .metric{background:#0b1825;border:1px solid #1f2a3a;padding:14px;border-radius:14px}.metric .v{font-size:26px;font-weight:700}
  </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex;justify-content:space-between;align-items:center">
      <div class="brand"><div class="logo" aria-hidden="true"></div><h1>Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ - Ø§Ù„Ù…Ø´Ø§Ø¹Ù„ ğŸ“</h1></div>

    </div>
  </header>
  <main class="container">
    <section class="cards" aria-label="Ù…Ù„Ø®Øµ">
      <div class="metric"><div class="muted">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¯</div><div class="v" id="metricSubjects">-</div></div>
      <div class="metric"><div class="muted">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</div><div class="v" id="metricUpcoming">-</div></div>
      <div class="metric"><div class="muted">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ</div><div class="v" id="metricGPA">-</div></div>
      <div class="metric"><div class="muted">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</div><div class="v" id="metricAttendance">-</div></div>
    </section>
    <div class="toolbar">
      <nav style="display:flex; gap: 10px;">
        <a href="dashboard-teacher.html" class="btn secondary" style="background:#111827; color:var(--text); font-weight:400;">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…</a>
        <a href="dashboard-admin.html" class="btn secondary" style="background:#111827; color:var(--text); font-weight:400;">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
        <a href="dashboard-manager.html" class="btn secondary" style="background:#111827; color:var(--text); font-weight:400;">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</a>
      </nav>
      <div>
        <select id="termFilter"><option value="current">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ</option><option value="prev">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚</option></select>
        <input id="subjectFilter" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø§Ø¯Ø©..."/>
      </div>
      <small class="muted">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firestore</small>
    </div>
<section class="grid">
      <div class="card">
        <h2>Ø¬Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</h2>
        <p class="muted">ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</p>
        <div id="scheduleImageContainer" style="text-align: center; border: 1px solid #1f2a3a; border-radius: 10px; padding: 10px; overflow-x: auto;">
          <img id="scheduleImage" src="placeholder-schedule.jpg" alt="Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ" style="max-width: 100%; height: auto; cursor: zoom-in; transition: max-width 0.3s ease-in-out;" onclick="toggleZoom(this)">
          <p class="muted" id="zoomHint">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„ØªÙƒØ¨ÙŠØ±/Ø§Ù„ØªØµØºÙŠØ±. Ø§Ø³Ø­Ø¨ Ù„Ù„ÙŠÙ…ÙŠÙ†/Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒØ§Ù…Ù„Ø§Ù‹.</p>
        </div>
      </div>
      <div class="card">
        <h2>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª ÙˆØ§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h2>
        <ul id="assignmentsList">
          <li class="muted" style="list-style: none;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ø£Ùˆ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</li>
        </ul>
      </div>
    </section>
    <section class="grid">
      <div class="card">
        <h2>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h2>
        <table class="table" id="attendanceTable"><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>ØªÙ‚Ø±ÙŠØ±</th></tr></thead><tbody id="attendanceBody"></tbody></table>
      </div>
      <div class="card">
        <h2>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
        <table class="table" id="tableExams"><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¯Ù‰</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody></tbody></table>
      </div>
    </section>
    <section class="grid">
      <div class="card">
        <h2>Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
        <table class="table" id="tableResults"><thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</th><th>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</th><th>Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th><th>Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</th></tr></thead><tbody></tbody></table>
      </div>
      <div class="card">
        <h2>Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ</h2>
        <canvas id="chartGrades" height="160"></canvas>
      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, getDocs, query, where, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    const firebaseConfig = { apiKey: "YOUR_FIREBASE_API_KEY", authDomain: "YOUR_PROJECT.firebaseapp.com", projectId: "YOUR_PROJECT_ID", storageBucket: "YOUR_PROJECT.appspot.com", messagingSenderId: "SENDER_ID", appId: "APP_ID" };
    const app = initializeApp(firebaseConfig); const auth = getAuth(app); const db = getFirestore(app);

    const $ = (id)=>document.getElementById(id);
    // const scheduleBody = document.querySelector('#tableSchedule tbody'); // ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨ØµÙˆØ±Ø©
    const examsBody = document.querySelector('#tableExams tbody');
    const resultsBody = document.querySelector('#tableResults tbody');

    function row(cols){ const tr=document.createElement('tr'); cols.forEach(c=>{ const td=document.createElement('td'); if(c instanceof Node) td.appendChild(c); else td.textContent=c ?? 'â€”'; tr.appendChild(td);}); return tr; }
    function pill(text, cls){ const s=document.createElement('span'); s.className=`pill ${cls||''}`; s.textContent=text; return s; }
    function letter(total){ if(total>=95) return 'A+'; if(total>=90) return 'A'; if(total>=85) return 'B+'; if(total>=80) return 'B'; if(total>=75) return 'C+'; if(total>=70) return 'C'; if(total>=60) return 'D'; return 'F'; }

    async function loadMetrics(uid){ const snap=await getDoc(doc(db,'students',uid)); const d=snap.exists()?snap.data():{}; $('metricSubjects').textContent=d.subjectCount ?? '-'; $('metricGPA').textContent=d.gpa ?? '-'; $('metricAttendance').textContent=d.attendancePct?`${d.attendancePct}%`:'-'; const examsQ=query(collection(db,'students',uid,'exams'), where('date','>=', new Date().toISOString().slice(0,10)), orderBy('date'), limit(10)); const eSnap=await getDocs(examsQ); $('metricUpcoming').textContent=eSnap.size; }
    async function loadSchedule(uid){ /* ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨ØµÙˆØ±Ø© */ }
    async function loadExams(uid){ examsBody.innerHTML=''; const today=new Date().toISOString().slice(0,10); const qy=query(collection(db,'students',uid,'exams'), orderBy('date')); const snap=await getDocs(qy); snap.forEach(docu=>{ const d=docu.data(); const status=d.date<today?pill('Ø§Ù†ØªÙ‡Ù‰','warn'):pill('Ù‚Ø§Ø¯ÙÙ…','ok'); const tdS=document.createElement('td'); tdS.appendChild(status); const tr=document.createElement('tr'); ['date','subject','type','range'].forEach(k=>{ const td=document.createElement('td'); td.textContent=d[k] ?? 'â€”'; tr.appendChild(td);}); tr.appendChild(tdS); examsBody.appendChild(tr);}); if(!snap.size) examsBody.appendChild(row(['â€”','â€”','â€”','â€”','â€”'])); }
    async function loadResults(uid){ resultsBody.innerHTML=''; const qy=query(collection(db,'students',uid,'results')); const snap=await getDocs(qy); const labels=[], totals=[]; snap.forEach(docu=>{ const d=docu.data(); const total=(+d.assignments||0)+(+d.exams||0)+(+d.final||0); labels.push(d.subject); totals.push(total); resultsBody.appendChild(row([d.subject,d.assignments,d.exams,d.final,letter(total)]));}); if(!snap.size) resultsBody.appendChild(row(['â€”','â€”','â€”','â€”','â€”'])); draw(labels, totals); }

    function draw(labels,data){ const c=$('chartGrades'); const ctx=c.getContext('2d'); const w=c.width=c.clientWidth||600; const h=c.height; ctx.clearRect(0,0,w,h); const pad=24, top=20, bottom=h-28, left=pad, right=w-pad; const max=Math.max(100, ...data, 0); ctx.strokeStyle='#1f2a3a'; ctx.beginPath(); ctx.moveTo(left,top); ctx.lineTo(left,bottom); ctx.lineTo(right,bottom); ctx.stroke(); ctx.fillStyle='#94a3b8'; ctx.font='12px Tajawal'; for(let i=0;i<=5;i++){ const y=bottom-(bottom-top)*i/5; ctx.strokeStyle='#122033'; ctx.beginPath(); ctx.moveTo(left,y); ctx.lineTo(right,y); ctx.stroke(); ctx.fillText(String(Math.round(max*i/5)),4,y-2);} if(!labels.length) return; const n=labels.length, gap=8, barW=Math.max(6,(right-left-gap*(n+1))/n); labels.forEach((lab,i)=>{ const x=left+gap+(barW+gap)*i; const val=data[i]||0; const y=bottom-(val/max)*(bottom-top); ctx.fillStyle='#22d3ee'; ctx.fillRect(x,y,barW,bottom-y); ctx.save(); ctx.translate(x+barW/2,bottom+12); ctx.rotate(-Math.PI/6); ctx.textAlign='center'; ctx.fillStyle='#94a3b8'; ctx.fillText(lab,0,0); ctx.restore();}); }

    onAuthStateChanged(auth, async (user)=>{
      if(!user){ console.warn('not signed in'); window.location.href = 'login-student.html'; return; }
      await Promise.all([loadMetrics(user.uid), loadAssignments(user.uid), loadAttendance(user.uid), loadExams(user.uid), loadResults(user.uid)]);
    });
      ul.innerHTML = '';
      // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firestore Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª/Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
      const assignments = [
        { type: 'ÙˆØ§Ø¬Ø¨', subject: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª', link: 'https://example.com/math-hw', teacher: 'Ø£. Ø®Ø§Ù„Ø¯', status: 'Ù„Ù… ÙŠØ­Ù„', teacherId: 'teacher-uid-1' },
        { type: 'Ø§Ù…ØªØ­Ø§Ù†', subject: 'ÙÙŠØ²ÙŠØ§Ø¡', link: 'https://example.com/physics-exam', teacher: 'Ø£. Ø³Ø§Ø±Ø©', status: 'ØªÙ… Ø§Ù„Ø­Ù„', teacherId: 'teacher-uid-2' },
      ];

      if (assignments.length === 0) {
        ul.innerHTML = '<li class="muted" style="list-style: none;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ø£Ùˆ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</li>';
        return;
      }

      assignments.forEach(assign => {
        const li = document.createElement('li');
        li.style.listStyle = 'none';
        const isDone = assign.status === 'ØªÙ… Ø§Ù„Ø­Ù„';
        const statusClass = isDone ? 'ok' : 'warn';
        const statusText = isDone ? 'ØªÙ… Ø§Ù„Ø­Ù„' : 'Ù„Ù… ÙŠØ­Ù„';

        li.innerHTML = `
          <div class="card" style="margin-bottom: 10px; padding: 10px; border-color: ${isDone ? '#22c55e' : '#f59e0b'};">
            <p style="margin: 0; display: flex; justify-content: space-between; align-items: center;">
              <span>
                <span class="pill ${statusClass}">${assign.type}</span>
                ${assign.subject} Ù…Ù† ${assign.teacher}
              </span>
              <span class="pill ${statusClass}">${statusText}</span>
            </p>
            <p style="margin: 5px 0 0 0;">
              <a href="${assign.link}" target="_blank" onclick="markAsDone('${assign.link}', '${uid}', '${assign.subject}')" style="color: var(--pri);">
                ${assign.link}
              </a>
            </p>
          </div>
        `;
        ul.appendChild(li);
      });
    }

    // ÙˆØ¸ÙŠÙØ© Ù„ØªØ³Ø¬ÙŠÙ„ Ø¶ØºØ· Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·
    window.markAsDone = async (link, uid, subject) => {
      // Ù‡Ù†Ø§ ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Firebase Ù„ØªØ³Ø¬ÙŠÙ„ Ø£Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ Ù‚Ø§Ù… Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·
      alert(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¶ØºØ·Ùƒ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø·: ${link}. Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡ ÙƒÙ€ "ØªÙ… Ø§Ù„Ø­Ù„" ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù….`);
      // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Firestore
      // await db.collection('students').doc(uid).collection('assignments').doc(subject).update({ status: 'ØªÙ… Ø§Ù„Ø­Ù„' });
    }

    // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨
    async function loadAttendance(uid) {
      const tbody = $('attendanceBody');
      tbody.innerHTML = '';
      // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firestore Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±
      const records = [
        { date: '2025-10-20', status: 'Ø­Ø§Ø¶Ø±', report: 'â€”' },
        { date: '2025-10-21', status: 'ØºØ§Ø¦Ø¨', report: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ù„Ù„ÙˆÙ„ÙŠ' },
      ];

      records.forEach(record => {
        const tr = document.createElement('tr');
        const statusClass = record.status === 'ØºØ§Ø¦Ø¨' ? 'warn' : record.status === 'Ø­Ø§Ø¶Ø±' ? 'ok' : 'warn';
        tr.innerHTML = `
          <td>${record.date}</td>
          <td><span class="pill ${statusClass}">${record.status}</span></td>
          <td>${record.report}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Ø±ÙˆØ§Ø¨Ø· ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø´Ø®ØµÙŠ
    document.getElementById('profileLink').addEventListener('click', (e) => {
      e.preventDefault();
      alert('Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø´Ø®ØµÙŠ ÙˆØ·Ø±Ù‚ Ø§Ù„ØªÙˆØ§ØµÙ„.');
    });
    document.getElementById('chatLink').addEventListener('click', (e) => {
      e.preventDefault();
      alert('Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØºØ±Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.');
    });

    onAuthStateChanged(auth, async (user)=>{
if(!user){ console.warn('not signed in'); window.location.href = 'login-student.html'; return; }
	      await Promise.all([loadMetrics(user.uid), loadAssignments(user.uid), loadAttendance(user.uid), loadExams(user.uid), loadResults(user.uid)]);
	    });

    document.getElementById('btnRefresh').addEventListener('click', ()=>{ const u=auth.currentUser; if(u){ loadMetrics(u.uid); loadAssignments(u.uid); loadAttendance(u.uid); loadExams(u.uid); loadResults(u.uid); }});
    document.getElementById('btnSignOut').addEventListener('click', ()=> signOut(auth));
  </script>
</body>
</html>
